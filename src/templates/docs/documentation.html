{% extends './base.html' %}

{% block content %}
<div class="demo-card-wide mdl-card mdl-shadow--2dp">
    <div class="mdl-card__title">
        <h2 class="mdl-card__title-text">API Information</h2>
    </div>
    <div class="mdl-card__supporting-text">
        <p>There are 3 (tree) api endpoints to be used:</p>
        <ul>
            <li><a href="call/start/">call/start/</a></li>
            <li><a href="call/start/">call/end/</a></li>
            <li><a href="telephone/bill/">telephone/bill/</a></li>
        </ul>
        <p>
            The first and second api calls only accept <strong>POST</strong> method. Because the record in database operations
            about the call.
        </p>
        <p>
            The third accept <strong>GET or POST</strong> method, and returns information about the telephone bill.
        </p>
    </div>
</div>
<br />
<div class="demo-card-wide mdl-card mdl-shadow--2dp">
    <div class="mdl-card__title">
        <h2 class="mdl-card__title-text"><strong>Start a Call</strong></h2>
    </div>
    <div class="mdl-card__supporting-text">
        <p>The first endpoint of the api is starting a call... to do that make a post request to <strong>call/start/</strong></p>
        <p>See example bellow to understand how to proceed.</p>

        REQUEST message:
        <pre>
            <code class="json">
    {
        "type":  "start", // Indicate if it's a call "start" or "end" record;
        "timestamp":  "1536939832.731359", // The timestamp of when the event occured;
        "call_id":  70, // Unique for each call record pair;
        "source":  "55994467898", // The subscriber phone number that originated the call;
        "destination":  "55994487710" // The phone number receiving the call.
    }
            </code>
        </pre>
        RESPONSE message:
        <pre>
            <code class="json">
    {
        "status":  200, // status code, following html standard
        "success":  true, // simple boolean message to validated request sucess
        "execution_time":  000001, // time in milliseconds that the request took
        "message":  "Success", // Full message... success or error
        "result":  null // if any results should be send back to developer
    }
            </code>
        </pre>
    </div>
    <div class="mdl-card__actions mdl-card--border">
        <div class="btn-right">
            <button id="try-it-call-start" class="mdl-button mdl-js-button mdl-button--raised">Try it</button>
        </div>
        <div id="call-start-test-result" style="display: none;">
            <strong>RESULT:</strong>
            <pre>
                <code class="json"></code>
            </pre>
        </div>
    </div>
</div>
<br />
<div class="demo-card-wide mdl-card mdl-shadow--2dp">
    <div class="mdl-card__title">
        <h2 class="mdl-card__title-text"><strong>End a Call</strong></h2>
    </div>
    <div class="mdl-card__supporting-text">
        <p>The second endpoint of the api is ending a call... to do that make a post request to <strong>call/end/</strong></p>
        <p>See example bellow to understand how to proceed.</p>

        REQUEST message:
        <pre>
            <code class="json">
    {
        "type":  "end", // Indicate if it's a call "start" or "end" record;
        "timestamp":  "1536939832.731359", // The timestamp of when the event occured;
        "call_id":  70, // Unique for each call record pair;
        "source":  "55994467898", // The subscriber phone number that originated the call;
        "destination":  "55994487710" // The phone number receiving the call.
    }
            </code>
        </pre>
        RESPONSE message:
        <pre>
            <code class="json">
    {
        "status":  200, // status code, following html standard
        "success":  true, // simple boolean message to validated request sucess
        "execution_time":  000001, // time in milliseconds that the request took
        "message":  "Success", // Full message... success or error
        "result":  null // if any results should be send back to developer
    }
            </code>
        </pre>
    </div>
    <div class="mdl-card__actions mdl-card--border">
        <div class="btn-right">
            <button id="try-it-call-end" class="mdl-button mdl-js-button mdl-button--raised">Try it</button>
        </div>
        <div id="call-end-test-result" style="display: none;">
            <strong>RESULT:</strong>
            <pre>
                <code class="json"></code>
            </pre>
        </div>
    </div>
</div>
<br />
<div class="demo-card-wide mdl-card mdl-shadow--2dp">
    <div class="mdl-card__title">
        <h2 class="mdl-card__title-text"><strong>Telephone Bill</strong></h2>
    </div>
    <div class="mdl-card__supporting-text">
        <p>Last, but not least is the endpoint which will bring the bill account for some telephone number over a period (in case requested)
            ... to do that make a post request to <strong>telephone/bill/</strong></p>
        <p>See example bellow to understand how to proceed.</p>

        REQUEST message:
        <pre>
            <code class="json">
    {
        "telephone_number":  "55994467898", // The subscriber phone number that originated the call;
        "reference_period":  "09/2018", // The period to filter, optional;
    }
            </code>
        </pre>
        RESPONSE message:
        <pre>
            <code class="json">
    {
        "status":  200, // status code, following html standard
        "success":  true, // simple boolean message to validated request sucess
        "execution_time":  000001, // time in milliseconds that the request took
        "message":  "Success", // Full message... success or error
        "result":  { // if any results should be send back to developer
            "telephone_number":  "55994467898", // The subscriber phone number that originated the call;
            "reference_period":  "09/2018", // The period to filter, optional;
            "total_call_price": 3.96, // Total value for this bill
            "total_call_duration": "0h35m42s", // Total time expend in calls
            "calls": [{ // Each call in the period
                "destination": "55994487710",
                "call_start_date": "14/09/2018",
                "call_start_time": "10:19:01",
                "call_duration": "0h35m42s",
                "call_price": 3.96
            }]
        }
    }
            </code>
        </pre>
    </div>
    <div class="mdl-card__actions mdl-card--border">
        <div class="btn-right">
            <button id="try-it-telephone-bill" class="mdl-button mdl-js-button mdl-button--raised">Try it</button>
        </div>
        <div id="telephone-bill-test-result" style="display: none;">
            <strong>RESULT:</strong>
            <pre>
                <code class="json"></code>
            </pre>
        </div>
    </div>
</div>
<script>
    // Example code to start a call
    document.getElementById('try-it-call-start').onclick = function() {
        var data = {
            "type":  "start",
            "timestamp":  "1536939832.731359",
            "call_id":  70,
            "source":  "55994467898",
            "destination":  "55994487710"
        };

        axios.post('call/start/', data).then(function(response) {
            var elem = document.getElementById('call-start-test-result');
            var code = elem.children[1].children[0];
            elem.style.display = 'block'
            code.innerHTML = JSON.stringify(response.data);
        }).catch(function(error) {
            console.log(error);
        });
    };
    // Example code to end a call
    document.getElementById('try-it-call-end').onclick = function() {
        var data = {
            "type":  "end",
            "timestamp":  "1536943424.851679",
            "call_id":  70,
            "source":  "55994467898",
            "destination":  "55994487710"
        };

        axios.post('call/end/', data).then(function(response) {
            var elem = document.getElementById('call-end-test-result');
            var code = elem.children[1].children[0];
            elem.style.display = 'block'
            code.innerHTML = JSON.stringify(response.data);
        }).catch(function(error) {
            console.log(error);
        });
    };
    // Example code to retrieve bill
    document.getElementById('try-it-telephone-bill').onclick = function() {
        var data = {
            "telephone_number":  "55994467898",
            "reference_period":  "09/2018"
        };

        axios.get('telephone/bill/', data).then(function(response) {
            var elem = document.getElementById('telephone-bill-test-result');
            var code = elem.children[1].children[0];
            elem.style.display = 'block'
            code.innerHTML = JSON.stringify(response.data);
        }).catch(function(error) {
            console.log(error);
        });
    };
</script>
{% endblock %}